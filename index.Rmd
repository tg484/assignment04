---
title: "index"
author: "Payal Soneja and Tanya Grover"
date: "2/17/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r file download}
pulse_data <- read_csv("data/pulse2022_puf_41.csv")
pulse_weights <- read_csv("data/pulse2022_repwgt_puf_41.csv")
pulse_join <- full_join(pulse_data, pulse_weights, by = "SCRAM")
svy_all <- pulse_join %>%
  as_survey_rep(
    repweights = dplyr::matches("PWEIGHT[0-9]+"),
    weights = PWEIGHT,
    type = "BRR",
    mse = TRUE
  )
```

## Including Plots


```{r vaccination plans, ECHO = true}
svy_all %>%
  filter(GETVACRV != -99 & GETVACRV != -88) %>%
  mutate(VaccinationPlan = case_when(GETVACRV == 1 ~ "Definitely get a vaccine",
                                     GETVACRV == 2 ~ "Probably get a vaccine",
                                     GETVACRV == 3 ~ "Be unsure about getting a vaccine",
                                     GETVACRV == 4 ~ "Probably NOT get a vaccine",
                                     GETVACRV == 5 ~ "Definitely NOT get a vaccine")) %>%
  group_by(VaccinationPlan) %>%
  summarize(prop_respondents = survey_prop()) %>%
  mutate(percentage_respondents = scales::percent(prop_respondents)) %>%
  ggplot(aes(x = "", y = percentage_respondents, fill = VaccinationPlan)) +
  geom_bar(width = 1,  stat = "identity", color = "white") +
  coord_polar("y", start = 0) +
  geom_text(aes(label = percentage_respondents), 
            position = position_stack(vjust = 0.5), size = 3) +
  theme_void() +
  scale_fill_brewer(palette = "Blues") +
  labs(title = "Vaccination Plans", subtitle = "United States", caption = 
         "Source: U.S. Census Bureau, Household Pulse Survey Week 41 of 2022") +
  guides(fill=guide_legend(title="Vaccination Plans")) 
```



```{r vaccine doses by region, ECHO = TRUE}
svy_all %>%
  filter(NUMDOSES != -99 & NUMDOSES != -88) %>%
  mutate(Region = case_when(REGION == 1 ~ "Northeast",
                            REGION == 2 ~ "South",
                            REGION == 3 ~ "Midwest",
                            REGION == 4 ~ "West")) %>%
  group_by(Region, NUMDOSES) %>%
  summarize(prop_respondents = survey_prop()) %>%
  ggplot(mapping = aes(x = Region, y = prop_respondents, 
                       fill = factor(NUMDOSES)), color = "grey") + 
  geom_col() +
  geom_text(aes(label =  paste0(round(100 * prop_respondents, 0), "%")), 
            position = position_stack(vjust = 0.5)) +
  scale_y_continuous(labels=scales::percent) +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal() +
  labs(title = "Total Vaccine Doses", subtitle = "Data by Region",caption = 
         "Source: U.S. Census Bureau, Household Pulse Survey Week 41 of 2022", y = "Percentage of Respondents", x =
         "Region") +
  guides(fill=guide_legend(title="Number of Doses")) 
```
